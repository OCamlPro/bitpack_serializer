<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Buffer (binary_encoding.Binary_encoding.Buffer)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">binary_encoding</a> &#x00BB; <a href="../index.html">Binary_encoding</a> &#x00BB; Buffer</nav><header class="odoc-preamble"><h1>Module <code><span>Binary_encoding.Buffer</span></code></h1><p>The Buffer defines the methods for reading and writing in a buffer. The compression algorithm used by the library works by writing bits after bits instead of bytes.</p></header><nav class="odoc-toc"><ul><li><a href="#writer">Writer</a></li><li><a href="#reader">Reader</a></li><li><a href="#statistics">Statistics</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-dictionary" class="anchored"><a href="#type-dictionary" class="anchor"></a><code><span><span class="keyword">type</span> <span>'dict dictionary</span></span><span> = </span></code><table><tr id="type-dictionary.NoDictionary" class="anchored"><td class="def variant constructor"><a href="#type-dictionary.NoDictionary" class="anchor"></a><code><span>| </span><span><span class="constructor">NoDictionary</span></span></code></td></tr><tr id="type-dictionary.Dictionary" class="anchored"><td class="def variant constructor"><a href="#type-dictionary.Dictionary" class="anchor"></a><code><span>| </span><span><span class="constructor">Dictionary</span> <span class="keyword">of</span> <span class="type-var">'dict</span></span></code></td></tr></table></div><div class="spec-doc"><p>A dictionary type. It is used as an argument for initialzing writers and readers.</p></div></div><h2 id="writer"><a href="#writer" class="anchor"></a>Writer</h2><div class="odoc-spec"><div class="spec type" id="type-writer" class="anchored"><a href="#type-writer" class="anchor"></a><code><span><span class="keyword">type</span> writer</span></code></div><div class="spec-doc"><p>A writer is a <a href="https://v2.ocaml.org/api/Bytes.html">Bytes</a> buffer where is written the data. It also contains an optional dictionary for string storage. It also holds statistics on the repartition of bits for each datatype (unsigned int, signed int and string).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-initialize_writer" class="anchored"><a href="#val-initialize_writer" class="anchor"></a><code><span><span class="keyword">val</span> initialize_writer : 
  <span>?with_dict:<span><span>int option</span> <a href="#type-dictionary">dictionary</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?init_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-writer">writer</a></span></code></div><div class="spec-doc"><p>Initializes a new buffer as a writer. If <code>with_dict</code> is set to <code>NoDictionary</code>, strings will be written in the buffer. If <code>with_dict</code> is set to <code>Dictionary None</code> (by default), strings will be replaced by an unknown size integers; a disctionary will be saved and concatenated at the beginning of the buffer after finalization. If <code>with_dict</code> is set to <code>Dictionary (Some size)</code>, it does the same than <code>Dictionary None</code> but it is assumed there will be no more than <code>size</code> words to save. registered in a dictionary (useful when the same string apprears at different places) and replaced by integers in the buffer. Variable <code>init_size</code> is the initial size of the writing bytes buffer (by default: 4096)</p></div></div><div class="odoc-spec"><div class="spec value" id="val-finalize" class="anchored"><a href="#val-finalize" class="anchor"></a><code><span><span class="keyword">val</span> finalize : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bytes.t</span></code></div><div class="spec-doc"><p>Returns the bytes representation of the buffer. If there is a dictionary, it is written at the beginning of the buffer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write buff v size</code></p><p>Writes <code>v</code> on <code>buff</code> using <code>size</code> bits. Value must be positive. Fails with <code>Invalid_argument</code> if <code>size</code> is not in <code>[0, 63]</code> or if <code>v</code> is negative or greater than <code>2^size</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_bool" class="anchored"><a href="#val-write_bool" class="anchor"></a><code><span><span class="keyword">val</span> write_bool : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Writes a boolean on 1 bit: <code>0</code> if <code>false</code>, <code>1</code> if <code>true</code>.</p></div></div><p>Write unsigned ints</p><div class="odoc-spec"><div class="spec value" id="val-write_uint8" class="anchored"><a href="#val-write_uint8" class="anchor"></a><code><span><span class="keyword">val</span> write_uint8 : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Equivalent to <code>write w v 8</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_uint16" class="anchored"><a href="#val-write_uint16" class="anchor"></a><code><span><span class="keyword">val</span> write_uint16 : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Equivalent to <code>write w v 16</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_uint32" class="anchored"><a href="#val-write_uint32" class="anchor"></a><code><span><span class="keyword">val</span> write_uint32 : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Equivalent to <code>write w v 32</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_uint63" class="anchored"><a href="#val-write_uint63" class="anchor"></a><code><span><span class="keyword">val</span> write_uint63 : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Equivalent to <code>write w v 63</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_z" class="anchored"><a href="#val-write_z" class="anchor"></a><code><span><span class="keyword">val</span> write_z : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Writes an unbounded integer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_signed_int" class="anchored"><a href="#val-write_signed_int" class="anchor"></a><code><span><span class="keyword">val</span> write_signed_int : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Same as <code>write_z w (Z.of_int i)</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_bytes_known_length" class="anchored"><a href="#val-write_bytes_known_length" class="anchor"></a><code><span><span class="keyword">val</span> write_bytes_known_length : <span>len:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_bytes_known_size ~len w b</code> Writes the first <code>len</code> bytes of <code>b</code> in argument.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_bytes" class="anchored"><a href="#val-write_bytes" class="anchor"></a><code><span><span class="keyword">val</span> write_bytes : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Writes a bytes buffer of any size.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_str_repr" class="anchored"><a href="#val-write_str_repr" class="anchor"></a><code><span><span class="keyword">val</span> write_str_repr : <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a string representation. If the buffer is associated to a dictionary, writes the its associated integer instead.</p></div></div><h2 id="reader"><a href="#reader" class="anchor"></a>Reader</h2><div class="odoc-spec"><div class="spec type" id="type-reader" class="anchored"><a href="#type-reader" class="anchor"></a><code><span><span class="keyword">type</span> reader</span></code></div><div class="spec-doc"><p>A reader buffer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-initialize_reader" class="anchored"><a href="#val-initialize_reader" class="anchor"></a><code><span><span class="keyword">val</span> initialize_reader : 
  <span>?with_dict:<span><span>int option</span> <a href="#type-dictionary">dictionary</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-reader">reader</a></span></code></div><div class="spec-doc"><p>Initializes a buffer as a reader. The <code>with_dict</code> argument must be the same as the argument used for initializing the writer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int64</span></code></div><div class="spec-doc"><p>read buff n reads n bits on the buffer as an unsigned value</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_bool" class="anchored"><a href="#val-read_bool" class="anchor"></a><code><span><span class="keyword">val</span> read_bool : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Reads 1 bit, returns <code>true</code> if <code>1</code>, <code>false</code> otherwise</p></div></div><p>Reads unsigned integers</p><div class="odoc-spec"><div class="spec value" id="val-read_uint8" class="anchored"><a href="#val-read_uint8" class="anchor"></a><code><span><span class="keyword">val</span> read_uint8 : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Reads 8 bits</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_uint16" class="anchored"><a href="#val-read_uint16" class="anchor"></a><code><span><span class="keyword">val</span> read_uint16 : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Reads 16 bits</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_uint32" class="anchored"><a href="#val-read_uint32" class="anchor"></a><code><span><span class="keyword">val</span> read_uint32 : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Reads 32 bits</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_uint63" class="anchored"><a href="#val-read_uint63" class="anchor"></a><code><span><span class="keyword">val</span> read_uint63 : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> int64</span></code></div><div class="spec-doc"><p>Reads 63 bits</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_signed_int" class="anchored"><a href="#val-read_signed_int" class="anchor"></a><code><span><span class="keyword">val</span> read_signed_int : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Reads an unsigned int prefixed by its size.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_z" class="anchored"><a href="#val-read_z" class="anchor"></a><code><span><span class="keyword">val</span> read_z : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Z</span>.t</span></code></div><div class="spec-doc"><p>Reads an unbounded integer</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_bytes_known_length" class="anchored"><a href="#val-read_bytes_known_length" class="anchor"></a><code><span><span class="keyword">val</span> read_bytes_known_length : <span>len:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> bytes</span></code></div><div class="spec-doc"><p>Reads <code>len</code> bytes and returns it as a bytes buffer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_bytes" class="anchored"><a href="#val-read_bytes" class="anchor"></a><code><span><span class="keyword">val</span> read_bytes : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bytes.t</span></code></div><div class="spec-doc"><p>Reads a integer representing the number of bytes to read, then reads and return these bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_str_repr" class="anchored"><a href="#val-read_str_repr" class="anchor"></a><code><span><span class="keyword">val</span> read_str_repr : <span><a href="#type-reader">reader</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Reads a string representation</p></div></div><h2 id="statistics"><a href="#statistics" class="anchor"></a>Statistics</h2><div class="odoc-spec"><div class="spec value" id="val-print_stats" class="anchored"><a href="#val-print_stats" class="anchor"></a><code><span><span class="keyword">val</span> print_stats : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-writer">writer</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Prints statistics of bits repartition of a buffer.</p></div></div></div></body></html>